# Pre-commit hooks for Fortress Rollback
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files
#
# See https://pre-commit.com for more information
#
# Cross-platform notes:
# - Works on Linux, macOS, and Windows (including native PowerShell)
# - All hooks use local Python scripts - no external repos that need bash
# - On Windows: no Git Bash or WSL required

default_language_version:
  python: python3

repos:
  # All hooks are local Python scripts for maximum Windows compatibility
  - repo: local
    hooks:
      # ══════════════════════════════════════════════════════════════════════
      # File hygiene checks
      # ══════════════════════════════════════════════════════════════════════
      - id: trailing-whitespace
        name: trim trailing whitespace
        entry: python scripts/hooks/trailing-whitespace.py
        language: python
        types: [text]

      - id: end-of-file-fixer
        name: fix end of files
        entry: python scripts/hooks/end-of-file-fixer.py
        language: python
        types: [text]

      - id: check-yaml
        name: check yaml
        entry: python scripts/hooks/check-yaml.py
        language: python
        types: [yaml]

      - id: check-toml
        name: check toml
        entry: python scripts/hooks/check-toml.py
        language: python
        types: [toml]

      - id: check-json
        name: check json
        entry: python scripts/hooks/check-json.py
        language: python
        types: [json]

      - id: check-merge-conflict
        name: check for merge conflicts
        entry: python scripts/hooks/check-merge-conflict.py
        language: python
        types: [text]

      - id: mixed-line-ending
        name: fix line endings (LF)
        entry: python scripts/hooks/mixed-line-ending.py
        language: python
        types: [text]

      # ══════════════════════════════════════════════════════════════════════
      # Python test quality
      # ══════════════════════════════════════════════════════════════════════
      - id: check-empty-tests
        name: check for empty test methods
        entry: python scripts/hooks/check-empty-tests.py
        language: python
        types: [python]
        files: 'test_.*\.py$|.*_test\.py$'

      # ══════════════════════════════════════════════════════════════════════
      # Rust checks
      # ══════════════════════════════════════════════════════════════════════
      - id: cargo-fmt
        name: cargo fmt
        entry: python scripts/run-cargo-fmt.py
        language: python
        types: [rust]
        pass_filenames: false

      - id: cargo-clippy
        name: cargo clippy
        entry: python scripts/run-cargo-clippy.py
        language: python
        types: [rust]
        pass_filenames: false

      - id: rustdoc-links
        name: rustdoc link check
        entry: python scripts/check-rustdoc-links.py
        language: python
        pass_filenames: false
        files: '\.rs$'

      # ══════════════════════════════════════════════════════════════════════
      # Documentation checks
      # ══════════════════════════════════════════════════════════════════════
      - id: markdownlint
        name: markdownlint (autofix)
        entry: python scripts/hooks/markdownlint.py
        language: python
        types: [markdown]
        exclude: '^(target/|fuzz/target/|loom-tests/target/|progress/|PLAN\.md)'

      - id: vale
        name: vale prose linting (advisory)
        entry: python scripts/hooks/vale.py
        language: python
        types: [markdown]
        files: ^docs/
        verbose: true

      - id: check-links
        name: check links
        entry: python scripts/check-links.py
        language: python
        pass_filenames: false
        files: '\.(md|rs)$'

      - id: check-code-fence-syntax
        name: check code fence syntax
        entry: bash scripts/check-code-fence-syntax.sh docs
        language: system
        pass_filenames: false
        files: '\.md$'

      - id: wiki-consistency
        name: wiki consistency check
        entry: python scripts/check-wiki-consistency.py
        language: python
        pass_filenames: false
        files: '^(docs/.*\.md|wiki/.*\.md|scripts/sync-wiki\.py)$'

      # ══════════════════════════════════════════════════════════════════════
      # CI validation (skip gracefully if tools not installed)
      # ══════════════════════════════════════════════════════════════════════
      - id: actionlint
        name: actionlint (GitHub Actions)
        entry: python scripts/hooks/actionlint.py
        language: python
        files: '^\.github/workflows/.*\.ya?ml$'
        pass_filenames: true

      - id: kani-coverage
        name: kani proof coverage
        entry: python scripts/check-kani-coverage.py
        language: python
        pass_filenames: false
        files: '\.rs$|verify-kani\.sh$'

      - id: cargo-hack-check
        name: cargo hack feature check
        entry: python scripts/check-cargo-hack.py
        language: python
        pass_filenames: false
        files: '\.rs$|Cargo\.toml$'
        stages: [pre-push]
