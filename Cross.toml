# Cross-rs configuration for cross-compilation
# See: https://github.com/cross-rs/cross/wiki/Configuration

# Environment variable passthrough allows CI to override linker settings.
#
# How this works:
# - Local development: Uses clang+lld from .cargo/config.toml (fast linking)
# - CI: Sets these environment variables to override to GCC linker (stable, no extra deps)
#
# This approach is more stable than using custom Docker images because:
# - Default cross-rs images are well-tested and maintained
# - No dependency on upstream image tag changes (e.g., :main)
# - CI controls its own toolchain without modifying the container
#
# Why we need BOTH target AND host variables:
# - Target (aarch64) variables: Configure linker for the final cross-compiled binaries
# - Host (x86_64) variables: Configure linker for build scripts and proc-macros that
#   compile and run on the host machine during the build process
#
# Without host variables, proc-macros would fail to link inside the cross container
# because they need to be compiled for x86_64, not aarch64.
#
# To override locally (if needed):
#   CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_LINKER=aarch64-linux-gnu-gcc \
#   CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_RUSTFLAGS="" \
#   cross check --target aarch64-unknown-linux-gnu
[build.env]
passthrough = [
    # Target (aarch64) variables - for cross-compiled binaries
    "CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_LINKER",
    "CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_RUSTFLAGS",
    # Host (x86_64) variables - for build scripts and proc-macros
    "CARGO_TARGET_X86_64_UNKNOWN_LINUX_GNU_LINKER",
    "CARGO_TARGET_X86_64_UNKNOWN_LINUX_GNU_RUSTFLAGS",
]

[target.aarch64-unknown-linux-gnu]
# No additional target-specific settings needed.
# Linker and rustflags are configured via:
# - .cargo/config.toml (local development with clang+lld)
# - Environment variables passed through [build.env] (CI with GCC)
